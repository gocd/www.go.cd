<!doctype html>
<html lang="en">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
    <meta content="GoCD is open source continuous delivery software. This post contains information about a security patch available for GoCD 15.2" name="description" />
    <meta content="GoCD, continuous delivery, continuous delivery software, continuous integration, continuous integration software, go, goforcd, open source, vulnerability, security, patch" name="keywords" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@goforcd" />
    <meta name="twitter:title" content="Vulnerability in GoCD | GoCD Blog" />
    <meta name="twitter:description" content="GoCD is open source continuous delivery software. This post contains information about a security patch available for GoCD 15.2" />
    <meta name="twitter:image" content="https://www.gocd.org/assets/images/blog/issues/issue-0621ef4e.png" />
    <link rel="canonical" href="https://www.gocd.org/2015/11/09/deserialization-vulnerability-commons-collections" />

    <title>Vulnerability in GoCD | GoCD Blog</title>
    <link href="../../../../assets/images/favicon.ico" rel="shortcut icon" />
    <link href="../../../../assets/stylesheets/site-bfa048f4.css" rel="stylesheet" />
    <script src="../../../../assets/javascripts/all-667de1bb.js" data-manual="true"></script>
    
    <link rel="alternate" type="application/atom+xml" title="GoCD blog feed" href="../../../../feed.xml" />
    <script>
      $(document).ready(function(){
      $('.chocolat-parent').Chocolat();
    });
    </script>
  </head>

  <body class="x2015 x2015_11 x2015_11_09 x2015_11_09_deserialization-vulnerability-commons-collections x2015_11_09_deserialization-vulnerability-commons-collections_index">
    <header class="top">
  <div class="container">
    <a href="../../../../" class="logo" analytics-label="logo"><img src="../../../../assets/images/go_logo-5b5ca9e1.svg" title="GoCD Logo" alt="GoCD Logo" /></a>
    <nav class="mainnav">
      <ul class="level0">
        <li><a href="../../../../why-gocd/" class="link_whygocd" analytics-label="link_whygocd">Features</a></li>
        <li><a href="https://docs.gocd.org/current/" class="link_documentation" analytics-label="link_help&gt;link_documentation">Documentation</a></li>
        <li><a href="../../../../blog/" class="link_blog" analytics-label="Blog">Blog</a></li>
        <li><a href="../../../../download/" class="link_download" analytics-label="Download">Download</a></li>
      </ul>
    </nav>
    <button class="navbtn menu collapse">
    <span></span>
    </button>
  </div>

</header>
<span id="top"></span>

    <div class="container blog-post">


  



  <div class="row">
    <div class="col-md-9">



  <header class="blog-post-header">
    <h1>Vulnerability in <span class="go">Go</span>CD - Java deserialization and Apache commons-collections</h1>
    <h4>GoCD Team</h4>
    <p class='tags'>
     </p>
  </header>

      <main id="main" role="main" class="blog-post-main-container">
      <p>This post contains information about a security patch available for GoCD 15.2 (and soon, earlier versions). If you're using GoCD 15.2 in production, and especially if it is available over the internet, it is highly recommended to apply this patch immediately.</p>

<p>[Any updates to this post are available starting <a href="#updates">here</a>]</p>

<h3 id="what-is-the-vulnerability">What is the vulnerability?</h3>

<p>As a part of AppSecCali 2015, a <a href="http://www.securitytube.net/video/13271">talk</a> highlighted a
<a href="http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/">vulnerability</a>
using Java deserialization with Apache commons-collections, a very commonly used library in Java-based
applications. Though the talk focused on other applications, GoCD is affected too.</p>

<h3 id="impact">Impact:</h3>

<p>This is a potentially serious issue and applying the patch is recommended, since it is a remote code execution
vulnerability in Java deserialization (exploited using Apache commons-collections).</p>

<p>The impact is reduced a bit, because as far as we are able to determine, this attack on the server is possible only by
having the authentication certificate of an already-registered and enabled Go Agent, because of the way the GoCD Server
and GoCD Agent communicate using a secure connection.</p>

<p>So, even if you have a GoCD server exposed to the internet, you're not immediately vulnerable, as far as we have been
able to determine (and we have given it a lot of thought).</p>

<h3 id="risks-of-applying-this-patch">Risks of applying this patch:</h3>

<p>This patch removes the known vector for this attack, as recommended by the vulnerability report. But, given the urgency,
this patch hasn't been extensively tested. There is a small potential for the Go Server to fail. However, given that the
patch is just a replaced JAR file, you can replace the original JAR file, if that happens and contact us on the
<a href="https://groups.google.com/d/topic/go-cd/DIj1RjQRuMo/discussion">GoCD community mailing list</a> or at support@thoughtworks.com (if you need a private way to reach some of the committers).</p>

<p>We have been using this patch on https://build.go.cd and it has been fine. We will update this post if anything new is
found.</p>

<h3 id="risks-of-not-applying-this-patch">Risks of not applying this patch:</h3>

<p>The GoCD server will be open to arbitrary remote code execution from anyone who has access to a <em>registered</em> Go Agent (or
the agent.jks file of such an agent). This is true of an agent which was once registered and then disabled as well.</p>

<h3 id="how-do-i-apply-this-patch">How do I apply this patch?</h3>

<p>Steps to apply the patch:</p>

<ol>
  <li>
    <p>Download the appropriate go.jar file mentioned below, for your version of the Go Server and verify its checksums.</p>
  </li>
  <li>Find out the location of your go.jar file and take a backup. On different ways of installation of Go, this can be in different places:
    <ul>
      <li>On Windows: It is usually in <code>C:\Program Files (x86)\Go Server\go.jar</code></li>
      <li>On Debian and RPM based installations: It is usually in <code>/usr/share/go-server/go.jar</code></li>
      <li>On zip installers: It is in the base directory where you start the Go Server from.</li>
    </ul>
  </li>
  <li>
    <p>Now that you have a backup of go.jar, stop the Go Server and replace go.jar with the one you downloaded.</p>
  </li>
  <li>Restart the Go Server.</li>
</ol>

<p>All of your agents will now fetch the new agent JAR as well, and restart themselves. Depending on the number of agents
you have, this might take a little while (same as an upgrade of the Go Server).</p>

<p>The different patches available are:</p>

<h4 id="section">15.2.0-2248:</h4>

<ul>
  <li>JAR file: <code>https://download.go.cd/local/patches/15.2.0-2015_11_09/go.jar</code></li>
  <li>MD5 checksum: <code>0872e4eefceaaf842a69d8b55ec6a2d0</code></li>
  <li>SHA256 sum: <code>eecee2b04c9bd46e74c5c999585683daf164fe41b39151dfcc3f0642561fd4c5</code></li>
  <li>GPG signature: <code>https://download.go.cd/local/patches/15.2.0-2015_11_09/go.jar.asc</code></li>
</ul>

<h4 id="section-1">15.1.0-1863:</h4>

<ul>
  <li>JAR file: <code>https://download.go.cd/local/patches/15.1.0-2015_11_10/go.jar</code></li>
  <li>MD5 checksum: <code>5981fee0fbd4e7be51a9d0351694bd13</code></li>
  <li>SHA256 sum: <code>8ffe0461ab7d0f5ab5aaf1c4a10f8519c7acf7d808bff987614a8e867edee152</code></li>
  <li>GPG signature: <code>https://download.go.cd/local/patches/15.1.0-2015_11_10/go.jar.asc</code></li>
</ul>

<h4 id="section-2">14.4.0-1356:</h4>

<ul>
  <li>JAR file: <code>https://download.go.cd/local/patches/14.4.0-2015_11_10/go.jar</code></li>
  <li>MD5 checksum: <code>72409fb8ee9a305b03439747043752bd</code></li>
  <li>SHA256 sum: <code>452c1cb7518d9654b000d18068729cd9a2072ce8bc262dededebc002f88141f8</code></li>
  <li>GPG signature: <code>https://download.go.cd/local/patches/14.4.0-2015_11_10/go.jar.asc</code></li>
</ul>

<h4 id="section-3">14.3.0-1186:</h4>

<ul>
  <li>JAR file: <code>https://download.go.cd/local/patches/14.3.0-2015_11_10/go.jar</code></li>
  <li>MD5 checksum: <code>64de38f7363a9345cad5e9c39aaa468e</code></li>
  <li>SHA256 sum: <code>80d98e12d0b18107840951b2c067edf554a966131373ab0015a585021f46538f</code></li>
  <li>GPG signature: <code>https://download.go.cd/local/patches/14.3.0-2015_11_10/go.jar.asc</code></li>
</ul>

<h4 id="section-4">14.2.0-377:</h4>

<ul>
  <li>JAR file: <code>https://download.go.cd/local/patches/14.2.0-2015_11_10/go.jar</code></li>
  <li>MD5 checksum: <code>68a711227d7a2cd663f304cf04c87139</code></li>
  <li>SHA256 sum: <code>6212eb9d0ab59d626e8ea3ec70ae0c34689f0de233502bd2f034fc91017c08f7</code></li>
  <li>GPG signature: <code>https://download.go.cd/local/patches/14.2.0-2015_11_10/go.jar.asc</code></li>
</ul>

<p>The JAR files above are signed using the usual key used to sign the RPM and DEB installers. The signature file provided can be used to verify it.
The public key is available on <a href="https://pgp.mit.edu/">MIT PGP Public Key Server</a> and
<a href="https://bintray.com/gocd">GoCD's bintray page</a>. When verified, you'll see that it is signed by the GoCD team:</p>

<pre><code>$ gpg --verify go.jar.asc go.jar
gpg: Signature made Mon Nov  9 12:13:21 2015 EST
gpg:                using RSA key 0x9149B0A6173454C7
gpg: Good signature from "Go CD (GPG key for signing bintray downloads) &lt;go-cd@googlegroups.com&gt;" [full]
Primary key fingerprint: 9A43 9A18 CBD0 7C3F F81B  CE75 9149 B0A6 1734 54C7
</code></pre>

<h3 id="i-dont-trust-you-how-do-i-generate-this-patched-gojar-myself">I don't trust you. How do I generate this patched go.jar myself?</h3>

<p>Glad you asked. Take a look at <a href="../../../../misc/generate-patched-jar-for-deserialization-vulnerability/">this</a>.</p>

<h3 id="updates">Updates:</h3>

<h4 id="update-1-9th-nov-2015---1830-est">Update 1: 9th Nov, 2015 - 1830 EST</h4>

<p>This patch fixes one of the known vectors, but there could be one other, TemplatesImpl, which <em>might</em> be vulnerable. From an early analysis, it doesn't seem to be, since it has some security and expects a JDK property to be set, before it is used. If we find more about it, this post will be updated. Even if it is vulnerable, there might not be much that can be done, because that is a class provided by the Java Runtime Environment itself. The long-term fix for issues such as this is to move away from Java serialization.</p>

<p>See these articles for more information: <a href="http://www.infoq.com/news/2015/11/commons-exploit">InfoQ: Remotely Exploitable Java Zero Day Exploits through Deserialization</a> and
<a href="http://fishbowl.pastiche.org/2015/11/09/java_serialization_bug/">The Java Deserialization Bug</a>.</p>

<h4 id="update-2-10th-nov-2015---1900-est">Update 2: 10th Nov, 2015 - 1900 EST</h4>

<ul>
  <li>Updated the "How do I apply this patch?" section with information about patches for older, supported versions.</li>
  <li>Removed the shell script for generating the patched version. It was too much information on this page. It is
<a href="../../../../misc/generate-patched-jar-for-deserialization-vulnerability/">linked</a>.</li>
  <li>Go is not vulnerable to the TemplatesImpl payload.</li>
</ul>

<p><strong>Note</strong>: This post will be updated with more information, as we find it and with information about patches for older, supported
installers. If you need help, please email the <a href="https://groups.google.com/d/topic/go-cd/DIj1RjQRuMo/discussion">GoCD community mailing list</a>
or for a private channel, support@thoughtworks.com.</p>

      </main>
    </div>
    <div class="col-md-3">
      <aside class="post-sidebar">
        <section  class="recent-articles">
          <h2 class="section-title">Recent Articles</h2>
          <ol>
            <li>
              <span class="post-date">Oct 11</span>
              <span class="post-author">Guest post by Abilash Rajasekaran</span>
              <a href="../../../../2020/10/11/perform-backup-for-gocd-on-kubernetes/">Perform Backup for GoCD on Kubernetes</a>
            </li>
            <li>
              <span class="post-date">Oct 11</span>
              <span class="post-author">Guest post by Abilash Rajasekaran</span>
              <a href="../../../../2020/10/11/restore-backup-for-gocd-on-kubernetes/">Restore Backup for GoCD on Kubernetes</a>
            </li>
            <li>
              <span class="post-date">Apr 14</span>
              <span class="post-author">Guest post by Abilash Rajasekaran</span>
              <a href="../../../../2020/04/14/gocd-on-kubernetes-using-terraform/">GoCD on Kubernetes using Terraform</a>
            </li>
            <li>
              <span class="post-date">Sep 17</span>
              <span class="post-author">Mohamed Najiullah</span>
              <a href="../../../../2019/09/17/configure-gocd-agents-kubernetes-static-elastic/">Configuring GoCD Agents in Kubernetes</a>
            </li>
            <li>
              <span class="post-date">Aug  5</span>
              <span class="post-author">Mohamed Najiullah</span>
              <a href="../../../../2019/08/05/configure-container-registry-gcr-artifact-store-gocd/">Configuring Google Container Registry (GCR) as an Artifact Store in GoCD</a>
            </li>
          </ol>
        </section>
        <section>
          <h2 class="section-title">By Year</h2>
          <ol>
            <li><a href="../../../../2020/">2020 (3)</a></li>
            <li><a href="../../../../2019/">2019 (7)</a></li>
            <li><a href="../../../../2018/">2018 (17)</a></li>
            <li><a href="../../../../2017/">2017 (39)</a></li>
            <li><a href="../../../../2016/">2016 (8)</a></li>
            <li><a href="../../../">2015 (21)</a></li>
            <li><a href="../../../../2014/">2014 (25)</a></li>
          </ol>
        </section>

      </aside>
    </div>
  </div>

  <div class="row">
    <div class="col-md-9">
      <div id="disqus_thread"></div>
      <script>
        var disqus_config = function () {
          /* Careful: Changing the value of page.url and page.identifier might mean you lose comments. */
          this.page.url = "https://www.go.cd/2015/11/09/deserialization-vulnerability-commons-collections.html";
          this.page.identifier = this.page.url;
          this.shortname = 'gocdblog';
        };
        (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//gocdblog.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-571784c91d5449dd"></script>

    <footer>
  <div class="join-community">
    <ul>
      <li>
        <a href="https://groups.google.com/forum/#!forum/go-cd" target="_blank" analytics-label="google-group">
          <i class="icon fa fa-users fa-4x join-us" aria-hidden="true"></i>
          <span>Join our discussion forum</span>
        </a>
      </li>
      <li>
        <a href="https://gitter.im/gocd/gocd" target="_blank" analytics-label="gitter">
          <i class="icon fa fa-comments fa-4x develop-with-us" aria-hidden="true"></i>
         <span>Chat with us</span>
        </a>
      </li>
      <li>
        <a href="https://github.com/gocd/gocd" target="_blank" analytics-label="github">
          <i class="icon fa fa-github fa-4x watch-us" aria-hidden="true"></i>
          <span>watch us</span>
        </a>
      </li>
    </ul>
  </div>

  <div class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-2">
          <ul class="unordered-list">
            <li><a href="../../../../download/">DOWNLOAD GoCD</a></li>
            <li><a href="../../../../getting-started/part-1/">INTRO TO GoCD</a></li>
            <li><a href="../../../../test-drive-gocd.html">TEST DRIVE GoCD</a></li>

          </ul>
        </div>

        <div class="col-md-2">
          <ul class="unordered-list">
            <li><a href="../../../../plugins/">PLUGINS</a></li>
            <li><a href="../../../../resources/">RESOURCES</a></li>
            <li><a href="https://www.thoughtworks.com/privacy-policy">PRIVACY</a> </li>
          </ul>
        </div>

        <div class="col-md-2">
          <ul class="unordered-list">
            <li><a href="https://www.github.com/gocd" target="_blank">FORK US ON GITHUB</a></li>
            <li><a href='../../../../assets/gocd-brand-styleguide.zip'>LOGOS + BRAND</a></li>
            <li><a href="../../../../contribute/">CONTRIBUTE</a></li>
          </ul>
        </div>

        <div class="col-md-2">
        </div>

        <div class="col-md-4">
          <p>
            GoCD is an open-source project, sponsored by <a target="_blank" href="https://www.thoughtworks.com" analytics-label="link_footer_thoughtworks">ThoughtWorks Inc.</a>
            under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" title="Apache 2.0 License">Apache License, Version 2.0</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

    <div class='imagemodal'>
      <div class='imagemodalcontent'>
      </div>
      <div class='close'>&#10006;
      </div>
    </div>

  </body>
  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5T5PTB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>
// <![CDATA[
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5T5PTB');
// ]]>
</script>
<!-- End Google Tag Manager -->

<!-- Marketo async-->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('199-QDE-291');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End Marketo async-->

<!-- Twitter universal website tag code -->
<script>
!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
// Insert Twitter Pixel ID and Standard Event data below
twq('init','nw15k');
twq('track','PageView');
</script>
<!-- End Twitter universal website tag code -->

</html>
