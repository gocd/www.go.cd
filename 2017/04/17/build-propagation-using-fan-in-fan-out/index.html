<!doctype html>
<html>
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
    <meta content="A look at build propogation and some of the ways to move your build through the deployment pipeline." name="description" />
    <meta content="GoCD, build, build propagation, fan-in, fan-out, continuous delivery, build pipeline, cd pipeline, " name="keywords" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@goforcd" />
    <meta name="twitter:title" content="Build Propagation using Fan-in Fan-out | GoCD Blog" />
    <meta name="twitter:description" content="A look at build propogation and some of the ways to move your build through the deployment pipeline." />
    <meta name="twitter:image" content="https://www.gocd.org/assets/images/blog/build-propagation/build-propagation-hero-c6cae895.jpg" />
    <link rel="canonical" href="https://www.gocd.org/2017/04/17/build-propagation-using-fan-in-fan-out" />

    <title>Build Propagation using Fan-in Fan-out | GoCD Blog</title>
    <link href="../../../../assets/images/favicon.ico" rel="shortcut icon" />
    <link href="../../../../assets/stylesheets/site-a0cb725c.css" rel="stylesheet" />
    <script src="../../../../assets/javascripts/all-b01ebaac.js"></script>
    
    <link rel="alternate" type="application/atom+xml" title="GoCD blog feed" href="../../../../feed.xml" />
    <script>
      $(document).ready(function(){
    $('.chocolat-parent').Chocolat();
});
    </script>

  </head>

  <body class="x2017 x2017_04 x2017_04_17 x2017_04_17_build-propagation-using-fan-in-fan-out x2017_04_17_build-propagation-using-fan-in-fan-out_index">
    <header class="top">
  <div class="container">
    <a href="../../../../" class="logo" analytics-label="logo"><img src="../../../../assets/images/go_logo-5b5ca9e1.svg" title="GoCD Logo" alt="GoCD Logo" /></a>
    <nav class="mainnav">
      <ul class="level0">
        <li class="dropdown">
          <a href="../../../../why-gocd/" class="link_whygocd" analytics-label="link_whygocd">Why GoCD?</a>
        </li>
        <li class="dropdown">
          <a href="../../../../contribute/" class="toplink_contribute" analytics-label="link_community">Community</a>
          <ul  class="level1">
            <li><a href="../../../../contribute/" class="link_contribute" analytics-label="link_community&gt;link_contribute">Contribute</a></li>
            <li><a href="../../../../events/" class="link_events" analytics-label="link_community&gt;link_events">Events</a></li>
            <li><a href="../../../../plugins/" class="link_plugins" analytics-label="link_community&gt;link_plugins">Plugins</a></li>
          </ul>
        </li>
        <li><a href="../../../../blog/" class="link_blog" analytics-label="Blog">Blog</a></li>
        <li class="dropdown">
          <a href="../../../../help/" class="toplink_help" analytics-label="link_help">Help</a>
          <ul  class="level1">
            <li><a href="../../../../help/" class="getting-started" analytics-label="link_help&gt;link_getting_started">Getting started</a></li>
            <li><a href="https://docs.gocd.org/current/" target="_blank" analytics-label="link_help&gt;link_documentation">Documentation</a></li>
            <li><a href="../../../../resources.html" class="link_resources" analytics-label="link_help&gt;link_resources">Resources</a></li>
          </ul>
        </li>
        <li><a href="../../../../download/" class="link_download" analytics-label="link_help&gt;link_download">Download</a></li>
        <li><a href="https://www.thoughtworks.com/go" class="link_support" target="_blank" analytics-label="link_support">Get Support</a></li>
      </ul>
    </nav>
    <button class="navbtn menu collapse">
    <span></span>
    </button>
  </div>
</header>
<span id="top"></span>
<a href="http://github.com/gocd" class="github-fork-ribbon" target="_blank" analytics-label="link_header_fork&gt;link_download" title="Fork me on GitHub">Fork me on GitHub</a>

    <div class="container blog-post">


  



  <div class="row">
    <div class="col-md-9">

    <div class="post-banner">
      <figure>
  <img src="../../../../assets/images/blog/build-propagation/build-propagation-hero-c6cae895.jpg" alt="Part 4 - Build Propagation using Fan-in/Fan-out: Modeling Deployment Pipelines" />
</figure>

    </div>


  <header class="blog-post-header">
    <h1>Part 4 - Modeling Deployment Pipelines: Build Propagation using Fan-in/Fan-out</h1>
    <h4>Aravind S.V, Product Manager at GoCD</h4>
    <p class='tags'>
<a href="../../../../tags/modeling-deployment-pipelines.html" class="tag">        Modeling Deployment Pipelines
</a>     </p>
  </header>

      <main id="main" role="main" class="blog-post-main-container">
      
<p>This is the fourth post in the series - <a href="../../../../tags/modeling-deployment-pipelines.html">Modeling Deployment Pipelines</a>. In our <a href="../../06/reusing-pipelines.html">previous post</a>, we saw the advantages of reusing pipelines (using Templates). In this post, we’ll dive into ways to move your build through the deployment pipeline. Typically, once a build has gone through the various tests, it is deployed onto a set of environments such as UAT, pre-production and production (for example). This concept is called <strong>“Build Propagation”</strong>.</p>

<h2 id="fan-in--fan-out">Fan-in / Fan-out</h2>

<p>To implement the idea of build propagation in your pipeline, we can use a concept called <em>fan-in / fan-out</em>. In the image below, there is a “fan-out” from the end of the “Build” pipeline. It fans out into three functional test pipelines. The opposite of a fan-out is “fan-in”, where multiple (upstream) pipelines lead into a single (downstream) pipeline.</p>

<p>Here’s how that looks:</p>

<div class="imagezoom">
<img src="../../../../assets/images/blog/build-propagation/fan-in-fan-out-774eac6e.jpeg" alt="Fan-in Fan-out" title="Fan-in Fan-out" />
<span class="info_txt">Click image to zoom in</span>
</div>

<p>In this scenario, the “UAT” pipeline will wait for all three of its upstream functional test pipelines to <em>finish successfully</em> before it starts. This doesn’t happen just because there are three pipelines fanning into the “UAT” pipeline, but because those three pipelines trace back to the same code repository. This is important to understand. If all three pipelines traced back to different code repositories, for instance, then every successful pipeline run would lead to the “UAT” pipeline starting. Fan-in ensures consistency by making sure that all upstream pipelines which trace back to the same repository have all finished successfully for the same changeset.</p>

<p>In practice, this means that if one or more of the functional test pipelines fails, then the UAT pipeline doesn’t get triggered. This makes sense since that changeset is not “good enough” to go to UAT.</p>

<blockquote>
  <p><strong>That’s the real beauty of a CD pipeline - it prevents bad changes from reaching important environments (such as production).</strong></p>
</blockquote>

<p>The green arrow in the image represents “Build Propagation” in the pipeline. The installer artifact from the “Build installer” stage is fetched and used. This is the same installer artifact used by the functional test pipelines as well. So, the same artifact, built once, is being pushed further along in the pipeline.</p>

<h2 id="highlighting-dependencies">Highlighting Dependencies</h2>

<p>What we don’t see in the image above, are the dependencies between</p>

<ul>
  <li>the functional test pipelines and the code repository</li>
  <li>and between the UAT pipeline and the code repository.</li>
</ul>

<p>For the sake of completeness, we added these dependencies in and this is what the pipeline would look like.</p>

<div class="imagezoom">
<img src="../../../../assets/images/blog/build-propagation/pipeline-dependencies-64bb4fc3.jpeg" alt="Pipeline Dependencies" title="Pipeline Dependencies" />
<span class="info_txt">Click image to zoom in</span>
</div>

<p>As you can see, it complicates the image quite a bit and so, has been omitted from other images. Owing to GoCD’s fan-in ability, adding that dependency doesn’t change how and when the pipelines are triggered. If a commit is made to the code repository, it does not mean that the functional test pipelines are triggered. Since each functional test pipeline has two dependencies now, both of them have to be compatible (i.e. be the same version) before it triggers.</p>

<p>For example, if a commit was made in the repository, the “Build” pipeline would build first with that commit. If the "Build" pipeline is successful, then both the dependencies (often called <a href="https://docs.gocd.org/current/introduction/concepts_in_go.html#materials">materials</a>) of the functional test pipelines are compatible and the functional test pipelines will run.</p>

<p>Unlike the example in the image above, maybe your repositories are structured so that functional tests and deployment scripts are in their own repositories. If so, they can be modeled as shown below:</p>

<div class="imagezoom">
<img src="../../../../assets/images/blog/build-propagation/pipeline-repos-5e961b5b.jpeg" alt="Pipeline Repos" title="Pipeline Repos" />
<span class="info_txt">Click image to zoom in</span>
</div>

<p>The advantage of this approach is that a commit to the functional test repository does not trigger the “Build” pipeline (which makes sense). The latest successful instance of the “Build” pipeline will be verified using the new functional test code. In this case, fan-in does not apply, since the two dependencies of the functional test pipelines do not trace back to the same repository or repositories. Similarly, a change to the deployment scripts will not trigger the build and functional tests.</p>

<p>Depending on your business case, you might find it necessary to have a manual approval process, especially to deploy into sensitive environments such as production, and often pre-production (mostly because it is being used by several people and needs co-ordination). We’ll dive into how to create a manual approval process to propagate your build in <a href="../../../05/23/control-deployments-manual-approvals.html">our next post</a>. Stay tuned.</p>

<div class="row">
  <div class="downloadbanner">
  <div class="container">
    <div class="banner-with-cta">
      <p>Get started with simplifying continuous delivery. Download and use <span class="go">Go</span>CD for free</p>
      <a href="../../../../download/">Download</a>
    </div>
  </div>
</div>

</div>

      </main>
    </div>
    <div class="col-md-3">
      <aside class="post-sidebar">
        <section  class="recent-ariticles">
          <section class='post'>
            <div class='subscribe-to-blog blogpost'>
   <h3 class='subscribe-title'> Subscribe to The Pipeline</h3>
   <p style="font-size:12px; font-weight:300">Continuous Delivery news in your inbox</p>
    <div id="subscribe-info">
      Send us a mail to <a href="mailto:support@thoughtworks.com?subject=Sign%20me%20up%20for%20GoCD%20blog%20notifications">support@thoughtworks.com</a> and we will sign you up for a notification on new blog posts.
    </div>
    <script type="text/javascript">
      function initMarketoForm() {
        jQuery("#subscribe-info").html("<form id='mktoForm_5414'></form>");
        MktoForms2.loadForm("//app-e.marketo.com", "199-QDE-291", 5414);
      }
    </script>
    <script async="true" src="//app-e.marketo.com/js/forms2/js/forms2.min.js" onload="initMarketoForm()"></script>
</div>

          </section>
          <h2 class="section-title">Recent Articles</h2>
          <ol>
            <li>
              <span class="post-date">Oct  3</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../10/03/introduction-continuous-delivery-deployment-tools/">Part 5 - CD101: Common Tools for Continuous Delivery</a>
            </li>
            <li>
              <span class="post-date">Sep 26</span>
              <span class="post-author">Aravind SV</span>
              <a href="../../../09/26/are-you-ready-for-continuous-delivery-infographic/">Infographic - Are you ready for Continuous Delivery</a>
            </li>
            <li>
              <span class="post-date">Sep 19</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../09/19/actions-spread-devops-adoption/">Part 3 - You can’t buy DevOps, but you may need to sell it: Actions to spread DevOps Adoption</a>
            </li>
            <li>
              <span class="post-date">Sep 12</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../09/12/value-stream-mapping/">Part 4 - CD101: Getting Started with Value Stream Mapping</a>
            </li>
            <li>
              <span class="post-date">Sep  5</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../09/05/misconceptions-patterns-devops-adoption/">Part 2 - You can’t buy DevOps, but you may need to sell it: Misconceptions and Patterns to drive DevOps Adoption</a>
            </li>
          </ol>
        </section>
        <section>
          <h2 class="section-title">By Year</h2>
          <ol>
            <li><a href="../../../">2017 (32)</a></li>
            <li><a href="../../../../2016/">2016 (8)</a></li>
            <li><a href="../../../../2015/">2015 (21)</a></li>
            <li><a href="../../../../2014/">2014 (26)</a></li>
          </ol>
        </section>

      </aside>
    </div>
  </div>

  <div class="row">
    <div class="col-md-9">
      <div id="disqus_thread"></div>
      <script>
        var disqus_config = function () {
          /* Careful: Changing the value of page.url and page.identifier might mean you lose comments. */
          this.page.url = "https://www.go.cd/2017/04/17/build-propagation-using-fan-in-fan-out.html";
          this.page.identifier = this.page.url;
          this.shortname = 'gocdblog';
        };
        (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//gocdblog.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-571784c91d5449dd"></script>

    <footer>
  <div class="join-community">
    <div class="container">
      <h3>Join our community</h3>
      <ul>
        <li>
          <a href="https://groups.google.com/forum/#!forum/go-cd" target="_blank" analytics-label="google-group">
            <i class="icon fa fa-users fa-4x join-us" aria-hidden="true"></i>
            Join our discussion forum
          </a>
        </li>
        <li>
          <a href="https://gitter.im/gocd/gocd" target="_blank" analytics-label="gitter">
            <i class="icon fa fa-comments fa-4x develop-with-us" aria-hidden="true"></i>
           Chat with us
          </a>
        </li>
        <li>
          <a href="https://github.com/gocd/gocd" target="_blank" analytics-label="github">
            <i class="icon fa fa-github fa-4x watch-us" aria-hidden="true"></i>
            watch us
          </a>
        </li>
        <li>
          <a href="https://twitter.com/goforcd" target="_blank" analytics-label="twitter">
            <i class="icon fa fa-twitter fa-4x follow-us" aria-hidden="true"></i>
            follow us
          </a>
        </li>
        
        <li>
        <a href="../../../../subscribe/"><i class= 'icon fa fa-envelope fa-4x subscribe' aria-hidden='true'></i>subscribe</a>
        </li>
      </ul>
    </div>
  </div>
  <div class="page-footer">
    <div class="container">
      <div class="foo-content">
        <p>
          GoCD is an open-source project, sponsored by <a target="_blank" href="http://www.thoughtworks.com" analytics-label="link_footer_thoughtworks">ThoughtWorks Inc.</a>
          under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" title="Apache 2.0 License">Apache License, Version 2.0</a>
        </p>
        <h5 class="help-us-improve">Make this place better</h5>
        <a href="http://github.com/gocd" class="social-buttons" analytics-label="link_footer_fork"><i class="fa fa-code-fork" aria-hidden="true" target="_blank"></i> fork</a>
        <a href="https://github.com/gocd/www.go.cd/issues"  class="social-buttons" analytics-label="link_footer_github_issues"> <i class="fa fa-github" aria-hidden="true"></i> suggest</a>

        <p><a href="https://brandfolder.com/twproducts" target="_blank">Logos and brand guidelines</a></p>
      </div>
    </div>
  </div>
</footer>

    <div class='imagemodal'>
      <div class='imagemodalcontent'>
      </div>
      <div class='close'>&#10006;
      </div>
    </div>

  </body>
  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5T5PTB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>
// <![CDATA[
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5T5PTB');
// ]]>
</script>
<!-- End Google Tag Manager -->

<!-- Marketo async-->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('199-QDE-291');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End Marketo async-->

<!-- Twitter universal website tag code -->
<script>
!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
// Insert Twitter Pixel ID and Standard Event data below
twq('init','nw15k');
twq('track','PageView');
</script>
<!-- End Twitter universal website tag code -->

</html>
